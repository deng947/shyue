package ${class.pack}.web.controller;

import java.util.ArrayList;
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import ${class.pack}.${class.name};
import ${class.rootPack}.dao.QueryObject;
import ${class.rootPack}.service.GenericManager;
import ${class.rootPack}.web.util.PageUtil;

/**
 * Handle View (ViewObject ViewList QueryList BatchDelete)<br>
 * Freemarker AutoGenerated
 * 
 * @date ${time} 
 * 
 */
@Controller
public class ${class.name}Controller {
	private final Logger log = LoggerFactory.getLogger(getClass());
	@Autowired
	@Qualifier("${class.spell}Manager")
	private GenericManager<${class.name}, Long> ${class.spell}Manager;

	public void set${class.name}Manager(GenericManager<${class.name}, Long> ${class.spell}Manager) {
		this.${class.spell}Manager = ${class.spell}Manager;
	}
	
	/**
	 * ViewObjectById
	 * 
	 * @param id
	 * @param model
	 */
	@RequestMapping("/${class.spell}.do")
	public String view${class.name}(@RequestParam("id") Long id, Model model) {
		${class.name} ${class.spell} = ${class.spell}Manager.get(id);
		model.addAttribute(${class.spell});
		return "${class.module}/${class.spell}"; 
	}
	
	/**
	 * ListView 
	 * 
	 * @param request 
	 * @param model 
	 */
	@RequestMapping("/${class.spell}List.do")
	public String view${class.name}List(HttpServletRequest request, Model model)
			throws Exception {	
		PageUtil page = new PageUtil(${class.spell}Manager);
		//String queryName = (String) request.getParameter("queryName");
		List<QueryObject> l = new ArrayList<QueryObject>();
			
		/* TODO add your Query here*/
		/*if (queryName != null && queryName.length() != 0) {
			QueryObject q = new QueryObject("description", QueryObject.LIKE,
					queryName + "%", QueryObject.STR);
			l.add(q);
		}*/
		page.setPageObjectToModel(request, model, l);
		return "${class.module}/${class.spell}List";
	}
	
	/**
	 * Batch delete items
	 *
	 * @param request
	 * @param model
	 * @return
	 * @throws Exception
	 */
	@RequestMapping("/delete${class.name}List.do")
	public String delete${class.name}List(HttpServletRequest request, Model model)
			throws Exception {
		String[] items = request.getParameterValues("item");
		if (items != null && items.length > 0) {
			Long[] ids = new Long[items.length];
			for (int i = 0; i < items.length; i++) {
				ids[i] = Long.valueOf(items[i]);
			}
			${class.spell}Manager.delete(ids, false);	
			logDelete(ids);	
		}
		//to viewList
		return view${class.name}List(request, model);
	}	
	
	private void logDelete(Long[] ids) {
		if (log.isDebugEnabled()) {
			StringBuffer sb = new StringBuffer("delete ${class.spell}List ids:");
			for (int i = 0; i < ids.length; i++) {
				sb.append(ids[i]).append(",");			
			}
			log.debug(sb.toString());
		}
	}
}
